<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>領餐作業</title>
   <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .order-details {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 20px;
            width: 600px; /* 調整訂單區塊寬度 */
            display: flex; /* 使用彈性盒子排列 */
            background-color: #fff;
        }

        .order-details h3 {
            margin: 0;
            color: #333;
        }

        .order-details p {
            margin: 5px 0;
        }

        .order-details .details {
            flex: 1; /* 設定訂單詳細資訊彈性伸縮 */
        }

        .status {
            margin-top: 10px;
            padding: 5px 10px;
            font-weight: bold;
            border-radius: 4px;
            display: inline-block;
            color: #f39c12; /* 設定製作中顏色 */
        }

        .countdown {
            margin-top: 5px;
            color: #e74c3c;
        }

        .remarks {
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: 5px;
            font-size: 14px;
            color: #555;
            font-family: Arial, sans-serif;
            text-align: left; /* 新增這行確保文字靠左 */
        }
    </style>
</head>
<body>

<!-- 使用Thymeleaf迭代訂單 -->
<div th:each="orderVO : ${orders}" class="order-details">
    <div class="details">
        <h3>訂單編號: <span th:text="${orderVO.ordId}"></span></h3>
        <p>取餐時間: <span th:text="${#dates.format(orderVO.ordReserveTime, 'yyyy-MM-dd HH:mm')}"></span></p>

        <!-- 使用Thymeleaf迭代訂單中的餐點 -->
        <p>訂購餐點:</p>
        <ul>
            <li th:each="orddVO : ${orderVO.orddList}">
                <span th:text="${orddVO.mealsVO.mealsName}"></span> x <span th:text="${orddVO.orddMealsQuantity}"></span>
            </li>
        </ul>

        <!-- 訂單狀態按鈕 -->
        <div class="status">
            <span th:text="${orderVO.ordStatus == 1 ? '製作中' : orderVO.ordStatus == 2 ? '製作完成' : orderVO.ordStatus == 3 ? '已取餐' : '未製作'}"></span>
        </div>
        <!-- 倒數計時 -->
        <div class="countdown" th:id="'countdown-' + ${orderVO.ordId}"></div>
        <!-- 更新訂單狀態表單 -->
        <form th:action="@{/updateOrderStatus}" method="post">
            <input type="hidden" th:name="ordId" th:value="${orderVO.ordId}">
            <label for="status">更新狀態:</label>
            <select id="status" name="status">
                <option value="0" th:selected="${orderVO.ordStatus == 0}">未製作</option>
                <option value="1" th:selected="${orderVO.ordStatus == 1}">製作中</option>
                <option value="2" th:selected="${orderVO.ordStatus == 2}">製作完成</option>
                <option value="3" th:selected="${orderVO.ordStatus == 3}">已取餐</option>
            </select>
            <button type="submit">更新</button>
        </form>
    </div>
</div>


<!-- 第一筆假設訂單 -->
<div class="order-details">
    <div class="details">
        <h3>訂單編號: 20240721</h3>
        <p>取餐時間: 10:00 AM</p>
        <p>訂購餐點: 培根蛋餅 x 2, 冰美式咖啡(中) x 1</p>
        <!-- 訂單狀態按鈕 -->
        <div class="status">
            製作中
        </div>
        <!-- 倒數計時 -->
        <div class="countdown" id="countdown-20240721"></div>
        <!-- 更新訂單狀態表單 -->
        <form action="/updateOrderStatus" method="post">
            <input type="hidden" name="orderId" value="20240721">
            <label for="status">更新狀態:</label>
            <select id="status" name="status">
                <option value="notStarted">未製作</option>
                <option selected value="inProgress">製作中</option>
                <option value="completed">製作完成</option>
                <option value="collected">已取餐</option>
            </select>
            <button type="submit">更新</button>
        </form>
    </div>
</div>

<!-- 第二筆假設訂單 -->
<div class="order-details">
    <div class="details">
        <h3>訂單編號: 20240724</h3>
        <p>取餐時間: 11:30 AM</p>
        <p>訂購餐點: 鮪魚三明治 x 1, 冰豆漿(中) x 1</p>
        <!-- 訂單狀態按鈕 -->
        <div class="status">
            製作中
        </div>
        <!-- 倒數計時 -->
        <div class="countdown" id="countdown-20240724"></div>
        <!-- 更新訂單狀態表單 -->
        <form action="/updateOrderStatus" method="post">
            <input type="hidden" name="orderId" value="20240724">
            <label for="status">更新狀態:</label>
            <select id="status" name="status">
                <option value="notStarted">未製作</option>
                <option selected value="inProgress">製作中</option>
                <option value="completed">製作完成</option>
                <option value="collected">已取餐</option>
            </select>
            <button type="submit">更新</button>
        </form>
    </div>
</div>

<!-- 第三筆假設訂單 -->
<div class="order-details">
    <div class="details">
        <h3>訂單編號: 20240725</h3>
        <p>取餐時間: 09:30 AM</p>
        <p>訂購餐點: 火腿蛋餅 x 2, 冰榛果拿鐵(中) x 1</p>
        <div style="border: 1px solid #ccc; padding: 25px; margin-top: 5px;">
            <p style="font-size: 14px; color: #555; font-family: Arial, sans-serif;">備註: 飲料不要加糖，謝謝<br>動作盡量快一點<br>還有給我兩包糖包</p>
        </div>

        <!-- 訂單狀態按鈕 -->
        <div class="status">
            製作中
        </div>
        <!-- 倒數計時 -->
        <div class="countdown" id="countdown-20240725"></div>
        <!-- 更新訂單狀態表單 -->
        <form action="/updateOrderStatus" method="post">
            <input type="hidden" name="orderId" value="20240725">
            <label for="status">更新狀態:</label>
            <select id="status" name="status">
                <option value="notStarted">未製作</option>
                <option selected value="inProgress">製作中</option>
                <option value="completed">製作完成</option>
                <option value="collected">已取餐</option>
            </select>
            <button type="submit">更新</button>
        </form>
    </div>
</div>

<!-- 第四筆假設訂單 -->
<div class="order-details">
    <div class="details">
        <h3>訂單編號: 20240726</h3>
        <p>取餐時間: 10:45 AM</p>
        <p>訂購餐點: 起司漢堡 x 1, 冰綠茶(中) x 2</p>
        <div style="border: 1px solid #ccc; padding: 25px; margin-top: 5px;">
            <p style="font-size: 14px; color: #555; font-family: Arial, sans-serif;">備註: 哈囉 尼好漂亮xd</p>
        </div>

        <!-- 訂單狀態按鈕 -->
        <div class="status">
            製作中
        </div>
        <!-- 倒數計時 -->
        <div class="countdown" id="countdown-20240726"></div>
        <!-- 更新訂單狀態表單 -->
        <form action="/updateOrderStatus" method="post">
            <input type="hidden" name="orderId" value="20240726">
            <label for="status">更新狀態:</label>
            <select id="status" name="status">
                <option value="notStarted">未製作</option>
                <option selected value="inProgress">製作中</option>
                <option value="completed">製作完成</option>
                <option value="collected">已取餐</option>
            </select>
            <button type="submit">更新</button>
        </form>
    </div>
</div>

<!-- 第五筆假設訂單 -->
<div class="order-details">
    <div class="details">
        <h3>訂單編號: 20240727</h3>
        <p>取餐時間: 08:00 AM</p>
        <p>訂購餐點: 起司蛋餅 x 1, 冰紅茶(大) x 2, 巧克力吐司</p>
        <div style="border: 1px solid #ccc; padding: 25px; margin-top: 5px;">
            <p style="font-size: 14px; color: #555; font-family: Arial, sans-serif;">備註: 不加辣,吐司焦一點</p>
        </div>

        <!-- 訂單狀態按鈕 -->
        <div class="status">
            製作中
        </div>
        <!-- 倒數計時 -->
        <div class="countdown" id="countdown-20240727"></div>
        <!-- 更新訂單狀態表單 -->
        <form action="/updateOrderStatus" method="post">
            <input type="hidden" name="orderId" value="20240727">
            <label for="status">更新狀態:</label>
            <select id="status" name="status">
                <option value="notStarted">未製作</option>
                <option selected value="inProgress">製作中</option>
                <option value="completed">製作完成</option>
                <option value="collected">已取餐</option>
            </select>
            <button type="submit">更新</button>
        </form>
    </div>
</div>

<script th:inline="javascript">
    /*<![CDATA[*/
    // 設定倒數計時功能
    function startCountdown(endTime, elementId) {
        var countDownDate = new Date(endTime).getTime();

        var x = setInterval(function() {
            var now = new Date().getTime();
            var distance = countDownDate - now;

            var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            var seconds = Math.floor((distance % (1000 * 60)) / 1000);

            var countdownElement = document.getElementById(elementId);
            if (countdownElement) {
                countdownElement.innerHTML = "剩餘時間: " + hours + "小時 " + minutes + "分 " + seconds + "秒 ";
                if (distance < 0) {
                    clearInterval(x);
                    countdownElement.innerHTML = "已超時";
                } else if (distance < 5 * 60 * 1000) { // 小於5分鐘，加急顯示
                    countdownElement.style.color = "#e74c3c";
                    countdownElement.innerHTML += "(急單)";
                }
            } else {
                clearInterval(x);
            }
        }, 1000);
    }

    // 啟動倒數計時器
    startCountdown("2024-07-18T10:00:00", "countdown-20240721");
    startCountdown("2024-07-18T11:30:00", "countdown-20240724");
    startCountdown("2024-07-18T09:30:00", "countdown-20240725");
    startCountdown("2024-07-18T10:45:00", "countdown-20240726");
    startCountdown("2024-07-18T08:00:00", "countdown-20240727");
    /*]]>*/
</script>

</body>
</html>
