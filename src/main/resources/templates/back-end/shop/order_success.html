<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>訂餐成功 - order_success.html</title>
    <head th:insert="~{/back-end/shop/included-fragment}"></head>
    <style type="text/css">
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f7f7f7;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            text-align: center;
            position: relative;
        }

        .success-title {
            font-size: 36px;
            color: #4CAF50;
            margin-bottom: 20px;
        }

        .success-message {
            font-size: 24px;
            color: #333;
            margin-bottom: 20px;
            overflow: hidden; /* 確保文字超出部分隱藏 */
            white-space: nowrap; /* 確保文字不換行 */
            animation: slideRightLeft 4s linear infinite alternate;
        }

        @keyframes slideRightLeft {
            0% {
                transform: translateX(0);
            }
            100% {
                transform: translateX(calc(100% - 100px));
            }
        }

        .order-details {
            text-align: left;
            margin-bottom: 20px;
        }

        .order-details p {
            margin: 5px 0;
        }

        .points {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-top: 20px;
        }

        .lottery-container {
            margin-top: 40px;
            position: relative;
        }

        #lottery-wheel {
            width: 300px;
            height: 300px;
            border: 1px solid #ccc;
            border-radius: 50%;
            transition: transform 3s ease-out;
        }

        #spin-button {
            display: block;
            margin: 20px auto;
            padding: 15px 30px;
            background-color: #FF5722;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #spin-button:hover {
            background-color: #E64A19;
        }

        .back-home {
            display: inline-block;
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            margin-top: 20px;
        }

        .back-home:hover {
            background-color: #45a049;
        }

        nav.navbar {
            margin-bottom: 40px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-md navbar-dark bg-success fixed-top justify-content-center">
        <div align="center">
            <h2>訂餐成功</h2>
            <h3><a class="navbar-brand" href="/shop/select_page"><img src="/images/back1.gif">返回查詢頁</a></h3>
        </div>
    </nav>

    <div class="container">
        <div class="success-message">
            <div>店家已收到訂單，餐點製作中</div>
        </div>
        <div class="order-details">
            <p>訂單編號: <span>24685446</span></p>
            <p>預約取餐時間: <span>2024-07-24 13:45:00</span></p>          
            <p>餐點: <span>鮪魚蛋餅x2,燻雞吐司x3,黑胡椒鐵板麵x1,奶茶(大)x1</span></p>
            <p>總金額: <span>NT$300</span></p>
        </div>
        <div class="points">
             <span id="pointsEarned"></span> 
        </div>
        <div class="lottery-container">
            <canvas id="lottery-wheel" width="300" height="300"></canvas>
            <button id="spin-button">我要抽獎</button>
        </div>
        <a href="/" class="back-home">返回首頁</a>
    </div>

    <script>
    var prizes = [
        { id: 1, name: '現金抵用券' },
        { id: 2, name: '免費餐點' },
        { id: 3, name: '飲料折抵券' },
        { id: 4, name: '限量禮品' },
        { id: 5, name: '免費甜點' },
        { id: 6, name: '折扣券' },
        { id: 7, name: '精美飾品' },
        { id: 8, name: '電子產品' },
        { id: 9, name: '特製禮盒' },
        { id: 10, name: '遊樂園門票' }
        // 您可以繼續添加更多獎品
    ];

        var pointsEarned = parseInt(document.getElementById('pointsEarned').innerText);
        var wheel = document.getElementById('lottery-wheel');
        var context = wheel.getContext('2d');

        var startAngle = 0;
        var arc = Math.PI / (prizes.length / 2);
        var spinTimeout = null;

        function drawRouletteWheel() {
            var outsideRadius = 150;
            var textRadius = 110;
            var insideRadius = 75;

            context.clearRect(0, 0, 300, 300);

            context.strokeStyle = '#000000';
            context.lineWidth = 2;

            context.font = 'bold 12px Helvetica, Arial';

            for(var i = 0; i < prizes.length; i++) {
                var angle = startAngle + i * arc;
                context.fillStyle = '#FFCC00';

                context.beginPath();
                context.arc(150, 150, outsideRadius, angle, angle + arc, false);
                context.arc(150, 150, insideRadius, angle + arc, angle, true);
                context.stroke();
                context.fill();

                context.save();
                context.fillStyle = '#000000';
                context.translate(150 + Math.cos(angle + arc / 2) * textRadius,
                                  150 + Math.sin(angle + arc / 2) * textRadius);
                context.rotate(angle + arc / 2 + Math.PI / 2);
                var text = prizes[i].name;
                context.fillText(text, -context.measureText(text).width / 2, 0);
                context.restore();
            }
        }

        function spinWheel() {
            spinAngleStart = Math.random() * 10 + 10;
            spinTime = 0;
            spinTimeTotal = Math.random() * 3 + 4 * 1000;
            rotateWheel();
        }

        function rotateWheel() {
            spinTime += 30;
            if(spinTime >= spinTimeTotal) {
                stopRotateWheel();
                return;
            }
            var spinAngle = spinAngleStart - easeOut(spinTime, 0, spinAngleStart, spinTimeTotal);
            startAngle += (spinAngle * Math.PI / 180);
            drawRouletteWheel();
            spinTimeout = setTimeout(rotateWheel, 30);
        }

        function stopRotateWheel() {
            clearTimeout(spinTimeout);
            var degrees = startAngle * 180 / Math.PI + 90;
            var arcd = arc * 180 / Math.PI;
            var index = Math.floor((360 - degrees % 360) / arcd);
            context.save();
            context.font = 'bold 20px Helvetica, Arial';
            var text = prizes[index].name;
            context.fillText(text, 150 - context.measureText(text).width / 2, 150);
            context.restore();

            // 彈出彈窗顯示獲得的獎品
            var prizeName = prizes[index].name;
            alert('恭喜您獲得：' + prizeName);
        }

        function easeOut(t, b, c, d) {
            var ts = (t/=d)*t;
            var tc = ts*t;
            return b+c*(tc + -3*ts + 3*t);
        }

        document.getElementById('spin-button').addEventListener('click', function() {
            spinWheel();
        });

        drawRouletteWheel();
        
        
    </script>
</body>
</html>
